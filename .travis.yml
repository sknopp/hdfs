sudo: required
language: go
go_import_path: github.com/colinmarc/hdfs
go: 1.x
env:
- PLATFORM=hdp2
- PLATFORM=cdh5
- PLATFORM=cdh6
- PLATFORM=cdh6 KERBEROS=true RPC_PROTECTION=authentication DATA_TRANSFER_PROTECTION=authentication
- PLATFORM=cdh6 KERBEROS=true RPC_PROTECTION=integrity DATA_TRANSFER_PROTECTION=integrity
- PLATFORM=cdh6 KERBEROS=true RPC_PROTECTION=privacy DATA_TRANSFER_PROTECTION=privacy
- PLATFORM=cdh6 KERBEROS=true RPC_PROTECTION=privacy DATA_TRANSFER_PROTECTION=privacy
  AES=true
before_install:
- export GO111MODULE=on
install:
- git clone https://github.com/sstephenson/bats $HOME/bats
- mkdir -p $HOME/bats/build
- "$HOME/bats/install.sh $HOME/bats/build"
- export PATH="$PATH:$HOME/bats/build/bin"
- "./travis-setup.sh $PLATFORM"
before_script:
- export HADOOP_CONF_DIR="/etc/hadoop/conf"
- find internal/protocol -name *.pb.go | xargs touch
script: make test
after_failure: find /var/log/hadoop-hdfs | xargs cat
before_deploy: make release
deploy:
  provider: releases
  api_key:
    secure: aqjdeDMzx5pCESUqVYjG052HAoMJ4gRMYsLkeyqL5BRXyZW0AySr86uJeCcT4F+E2IaxbFRStd+YOsBAAs0kkffSdCY04AulhFvxwZ7o7Dt1GNzIEsTkvife2isd+h2d6sXA/ZhyFTEg9fr4ylBd4BQ3SMSuXYcLjrLgNudECm+Zco2NF2igeiUa1UPcU2yzBklkzRuJqvLq4i8b+NxVk/f7M9ACZ7hH68QvDt0EdQZKyuMrUKPEqGOi0ZTZNiH/miZxJbYNkwb5f/2SeT5Hb6/EQzHj+6fmTqL0avGoxNb4sP9GLK5F0st9XFWppvSiexxnMxO8OYDXkzUJmf1zDh9FcfaB/GVTuRs9oKxaaqaij28/v/DQjMG83sFmd27+3Cd9xMp7rrZ0Sax2XrMWZsmnr+tvSQxssUmSGRj64I1KSjn8ov5iSQd2LQnlyntnS4Iqgh+7HWayU8VHockStrO3vQQywawPM4V1OBjHVrCSrag7f/526NJckx4rtHggEhCq7R2c52gq8LbOr8J5P08CiyCW+j9GBkdXV4OEnzryPd2lpZePFR0xjuFCOGxL4rvuj96a3P5EBW0tys42dMtcmwkbseyazWPHvKDVf5+2dZlLJ4ldc0hLte/PrDuEJFm5bhL+8itFTaCPSSU5Bf5OHSuJMl5cWeZiGNgqYCY=
  file: gohdfs-*.tar.gz
  file_glob: true
  skip_cleanup: true
  on:
    repo: sknopp/hdfs
cache:
  directories:
  - "$HOME/.cache/go-build"
  - "$GOPATH/pkg/mod"
